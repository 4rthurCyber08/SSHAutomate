
<!-- Your monitor number = 91 -->


## â›… Warm Up for Day 4.

### Setup your Day 1 BUT DO NOT configure any device.

<br>

## ðŸŽ¯ Review
### 1. Which two encoding methods are supported by REST APIs? (Choose Two)
	A. SGML
	B. YAML
	C. XML
	D. JSON
	E. EBCDIC

<br>

### 2. Which output displays a JSON data representation?
A.
~~~
	{
	  "response":{
	  "taskld":{};
	  "url": "string"
	  };
	  "version": "string"
	}
~~~

<br>

B.
~~~
	{
	  "response"-{
	  "taskld"-{},
	  "url"- "string"
	  },
	  "version"- "string"
	}
~~~

<br>

C.
~~~
	{
	  "response":{
	  "taskld":{},
	  "url": "string"
	  },
	  "version": "string"
	}
~~~

<br>

D.
~~~
	{
	  "response",{
	  "taskld",{};
	  "url", "string"
	  };
	  "version", "string"

	}
~~~

&nbsp;
---
&nbsp;

### 3. OSPF Configuration
Refer to the Topology.   
All routers are configured with IP addressing EXCEPT for the link between R1 & R3.  
Finish the configuration by completing the ff:  

<br>

Task 1.  
	Using the 172.16.160.0/21 network,   
	- assign the 1st VALID ip address on R1's e0/1 interface.
	- assign the Last VALID ip address on R3's e0/1 interface.

<br>

Task 2.  
	Configure single area OSPF on all routers with the ff:  
	- All routers belong to AREA 2
	- Use OSPF Process 5
	- Assign each router's LOOPBACK 0 as their router ID.
	- The link between R2 & R3 must be point-to-point.
	- R1 must have the lowest priority on its e0/0 & e0/1 interfaces.
	- Advertise all Connected routes.

<br>

Task 3.  
	Configure static routes.  
	- Configure a static host route on R1 destined for R3's LOOPBACK 
	using R3 as the next hop.
	- Configure a floating static route on R1 destined for R3's LOOPBACK 
	using R2 as the next hop with an Administrative Distance equal 
	to EXTERNAL EIGRP.

<br>
<br>

ANSWER HERE  
Task 1.  
~~~
@R1
conf t
 interface ___
  ip add ___.___.___.___  ___.___.___.___
  no shut
  end

@R3
conf t
 interface ___
  ip add ___.___.___.___  ___.___.___.___
  no shut
  end
~~~

<br>

Task 2.
~~~
@R1
conf t
 interface ___
  ip ospf ___ ___
 interface ___
  ip ospf ___ ___
 router ospf ___
  router-id ___.___.___.___
  network ___.___.___.___  ___.___.___.___ area ___
  network ___.___.___.___  ___.___.___.___ area ___
  network ___.___.___.___  ___.___.___.___ area ___
  end

@R2
conf t
 interface ___
  ip ospf ___ ___
  exit
 router ospf ___
  router-id ___ 
  network ___.___.___.___  ___.___.___.___ area ___
  network ___.___.___.___  ___.___.___.___ area ___
  network ___.___.___.___  ___.___.___.___ area ___
  end
  
@R3
conf t
 interface ___
  ip ospf ___ ___
  exit
 router ospf 5
  router-id ___ 
  network ___.___.___.___  ___.___.___.___ area ___
  network ___.___.___.___  ___.___.___.___ area ___
  network ___.___.___.___  ___.___.___.___ area ___
  end
~~~  

<br>

Task 3.
~~~
@R1
conf t
 ip route 192.168.5.33 255.255.255.___  ___.___.___.___
 ip route 192.168.5.33 255.255.255.___  ___.___.___.___  ___
 end
~~~

<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>

<details>
<summary>Show Answer</summary>

ANSWERS:  
Task 1.  
~~~
@R1
conf t
 interface e0/1
  ip add 172.16.160.1 255.255.248.0
  no shut
  end

@R3
conf t
 interface e0/1
  ip add 172.16.167.254 255.255.248.0
  no shut
  end
~~~

<br>

Task 2.
~~~
@R1
conf t
 interface e0/0
  ip ospf priority 0
 interface e0/1
  ip ospf priority 0
 router ospf 5
  router-id 172.16.97.111
  network 172.16.97.111 0.0.0.0 area 2
  network 10.0.15.64 0.0.0.31 area 2
  network 172.16.160.0 0.0.7.255 area 2
  end

@R2
conf t
 interface e0/1
  ip ospf network point-to-point
  exit
 router ospf 5
  router-id 10.46.187.22 
  network 10.46.187.22 0.0.0.0 area 2
  network 10.0.15.64 0.0.0.31 area 2
  network 192.168.0.152 0.0.0.3 area 2
  end
  
@R3
conf t
 interface e0/0
  ip ospf network point-to-point
  exit
 router ospf 5
  router-id 192.168.5.33
  network 192.168.5.33 0.0.0.0 area 2
  network 192.168.0.152 0.0.0.3 area 2
  network 172.16.160.0 0.0.7.255 area 2
  end
~~~

<br>

Task 3.
~~~
@R1
conf t
 ip route 192.168.5.33 255.255.255.255 172.16.167.254
 ip route 192.168.5.33 255.255.255.255 10.0.15.90 170
 end
~~~

</details>

<br>
<br>

---
&nbsp;

## Day 1 via Ansible
### Step 1 - Add routing to PC
~~~
!@cmd
route add 10.0.0.0 mask 255.0.0.0 10.91.1.4
route add 200.0.0.0 mask 255.255.255.0 10.91.1.4
~~~

<br>

### Step 2 - Add ip address and routing to device
~~~
!@coreTaas
conf t
 int vlan 1
  no shut
  ip add 10.91.1.2 255.255.255.0
  desc mgmtData-configuredManually
  exit
  enable secret pass
 line vty 0 14
  password pass
  transport input all
  login
  exec-timeout 0 0
  end
~~~

<br>

~~~
!@coreBaba
conf t
 int vlan 1
  no shut
  ip add 10.91.1.4 255.255.255.0
  desc mgmtData-configuredManually
  exit
 vlan 100
  name VOICEVLAN
  exit
 int vlan 100
  no shut
  ip add 10.91.100.4 255.255.255.0
  desc vlanMgmtVoice-configuredManually
  exit
 int fa 0/3
  sw mo ac
  sw ac vlan 100
  exit
 int gi0/1
  no switchport
  no shut 
  ip add 10.91.91.4 255.255.255.0
  exit
 ip routing
 ip route 0.0.0.0 0.0.0.0 10.91.91.1 120
 enable secret pass
 line vty 0 14
  password pass
  transport input all
  login
  exec-timeout 0 0
  end
~~~

<br>

~~~
!@cucm
conf t
 int fa0/0
  no shut
  ip add 10.91.100.8 255.255.255.0
  exit
 ip routing
 ip route 0.0.0.0 0.0.0.0 10.91.100.4 120
 enable secret pass
 line vty 0 14
  password pass
  transport input all
  login
  exec-timeout 0 0
  end
~~~

<br>

~~~
!@edge
conf t
 int gi 0/0/0
  ip add 10.91.91.1 255.255.255.0
  no shut
  exit
 ip routing
 ip route 10.91.0.0 255.255.0.0 10.91.91.4 120
 enable secret pass
 line vty 0 14
  password pass
  transport input all
  login
  exec-timeout 0 0
  end
~~~

&nbsp;
---
&nbsp;

### Step 3 - Telnet to each device
On SecureCRT:
| IP                 | Device   |
| ---                | ---      |
| 10.91.1.2	     | CoreTaas |
| 10.91.1.4      | CoreBaba |
| 10.91.100.8    | CUCM     |
| 10.91.91.1 | EDGE     |

&nbsp;
---
&nbsp;

### Step 4 - Note MAC Addresses
~~~
@CoreBaba
sh mac address-table
~~~

<br>

Camera 6 MAC Address (fa0/6):   6666.6666.6666
Camera 8 MAC Address (fa0/8):   8888.8888.8888
Ephone 1 MAC Address (fa0/5):    6cfa.8972.ecbf 
Ephone 2 MAC Address (fa0/7):   ccd8.c1fb.16f3 

&nbsp;
---
&nbsp;

### Step 4 - Enable SSH
For an SSH connection to be established, the device must have:
| Description                      | Command                                  |
| ---                              | ---                                      |
| a non-default hostname           | hostname coreBaba91                  |
| a domain name                    | ip domain name day1lab.com               |
| a local user account             | username admin privilege 15 secret pass  |
| generated crypto keys            | crypto key generate rsa modulus 2048     |
| SSH enabled                      | ip ssh version 2                         |
| enable remote access             | transport input all                      |
| enable remote user/pass login    | login local                              |

<br>

Extra lines
| Description             | Command                      |
| ---                     | ---                          |
| password encryption     | service password-encryption  |
| no logs                 | no logging console           |
| no domain lookups       | no ip domain-lookup          |
| no timeout              | exec-timeout 0 0             |

<br>

~~~
!@coreTaas
conf t
 hostname coreTaas-91
 service password-encryption
 no logging console
 no ip domain-lookup
 ip domain name autoday1.com
 username admin privilege 15 secret pass
 line vty 0 14
  transport input all
  login local
  exec-timeout 0 0
  exit
 crypto key generate rsa modulus 2048 label devs
 ip ssh rsa keypair-name devs
 ip ssh version 2
 end
~~~

<br>

~~~
!@coreBaba
conf t
 hostname coreBaba-91
 service password-encryption
 no logging console
 no ip domain-lookup
 ip domain name autoday1.com
 username admin privilege 15 secret pass
 line vty 0 14
  transport input all
  login local
  exec-timeout 0 0
  exit
 crypto key generate rsa modulus 2048 label devs
 ip ssh rsa keypair-name devs
 ip ssh version 2
 end
~~~

<br>

~~~
!@cucm
conf t
 hostname cucm-91
 service password-encryption
 no logging console
 no ip domain-lookup
 ip domain name autoday1.com
 username admin privilege 15 secret pass
 line vty 0 14
  transport input all
  login local
  exec-timeout 0 0
 crypto key generate rsa modulus 2048 label devs
 ip ssh rsa keypair-name devs
 ip ssh version 2
 end
~~~

<br>

~~~
!@edge
conf t
 hostname edge-91
 service password-encryption
 no logging console
 no ip domain-lookup
 ip domain name autoday1.com
 username admin privilege 15 secret pass
 line vty 0 14
  transport input all
  login local
  exec-timeout 0 0
 crypto key generate rsa modulus 2048 label devs
 ip ssh rsa keypair-name devs
 ip ssh version 2
 end
~~~

&nbsp;
---
&nbsp;

### Step 5 - Run Virtual Machines
NetOps:
  Name: NetOps-PH
  
  | NetAdapter   |                    |
  | ---          | ---                |
  | NetAdapter   | VMNet1             |
  | NetAdapter 2 | VMNet2             |
  | NetAdapter 3 | VMNet3             |
  | NetAdapter 4 | Bridge (Replicate) |

<br>

CSR1000v:
  Name: UTM-PH
  
  | NetAdapter   |        |
  | ---          | ---    |
  | NetAdapter   | NAT    |
  | NetAdapter 2 | VMNet2 |
  | NetAdapter 3 | VMNet3 |

&nbsp;
---
&nbsp;

### Step 6 - Set IP address and Routing
~~~
!@UTM-PH
conf t
 hostname UTM-PH
 enable secret pass
 service password-encryption
 no logging cons
 no ip domain lookup
 line vty 0 14
  transport input all
  password pass
  login local
  exec-timeout 0 0
 int g1
  ip add 208.8.8.11 255.255.255.0
  no shut
 int g2
  ip add 192.168.102.11 255.255.255.0
  no shut
 int g3
  ip add 11.11.11.113 255.255.255.224
  no shut
 !
 username admin privilege 15 secret pass
 ip http server
 ip http secure-server
 ip http authentication local
 ip route 0.0.0.0 0.0.0.0 208.8.8.2
 end
wr
!
~~~

<br>

__NetOps-PH Setup__
> Login: root
> Pass: C1sc0123

<br>

1. Get the MAC Address for the Bridge connection
VMWare > NetOps-PH Settings > NetAdapter (2, 3, & 4) > Advance > MAC Address

| NetAdapter   | MAC Address      | VM Interface | ENS     |
| ---          | ---              | ---          | ---     |
| NetAdapter 2 | 00:0C:29:FF:6C:FE  | ens192       |  ens192 |
| NetAdapter 3 | 00:0C:29:FF:6C:08  | ens224       |  ens224 |
| NetAdapter 4 | 00:0C:29:FF:6C:12  | ens256      |  ens256 |

<br>

2. Get Network-VM Mapping
~~~
!@NetOps-PH
ip -br link
~~~

<br>

3. Modify Interface IP
VMNet2:  192.168.102.6/24
VMNet3:  11.11.11.100/27
Bridged: 10.91.1.6/24

<br>

~~~
!@NetOps-PH
ifconfig ens192 192.168.102.6 netmask 255.255.255.0 up
ifconfig ens224 11.11.11.100 netmask 255.255.255.224 up
ifconfig ens256 10.91.1.6 netmask 255.255.255.0 up
~~~

<br>

Verify:
~~~
!@NetOps-PH
ip -4 addr

nmcli connection show
netstat -rn
~~~

<br>

or  

<br>

__Using Network Management CLI for persistent IP.__

<br>

VMNet2:
~~~
!@NetOps-PH
nmcli connection add \
type ethernet \
con-name VMNET2 \
ifname ens192 \
ipv4.method manual \
ipv4.addresses 192.168.102.6/24 \
autoconnect yes

nmcli connection up VMNET2
~~~

<br>

VMNet3:
~~~
!@NetOps-PH
nmcli connection add \
type ethernet \
con-name VMNET3 \
ifname ens224 \
ipv4.method manual \
ipv4.addresses 11.11.11.100/27 \
autoconnect yes

nmcli connection up VMNET3
~~~

<br>

Bridged:
~~~
!@NetOps-PH
nmcli connection add \
type ethernet \
con-name BRIDGED \
ifname ens256 \
ipv4.method manual \
ipv4.addresses 10.91.1.6/24 \
autoconnect yes

nmcli connection up BRIDGED
~~~

<br>

Verify:
~~~
!@NetOps-PH
ip -4 addr

nmcli connection show
netstat -rn
~~~

<br>

4. Routing
~~~
!@NetOps-PH
ip route add 10.0.0.0/8 via 10.91.1.4 dev ens256
ip route add 200.0.0.0/24 via 10.91.1.4 dev ens256
ip route add 0.0.0.0/0 via 11.11.11.113 dev ens224
~~~

&nbsp;
---
&nbsp;

### Remote Access
Connect to Management Interfaces of Devices
NetOps-PH: 192.168.102.6
UTM-PH: 192.168.102.11

&nbsp;
---
&nbsp;

### Step 7 - Exchange SSH Keys
Delete existing SSH Keys
~~~
!@NetOps
rm -rf /root/.ssh/known_hosts
~~~

<br>

SSH to the ff devices:
~~~
!@NetOps
ssh admin@10.91.1.2
~~~

<br>

| IP                 | Device   |
| ---                | ---      |
| 10.91.1.2      | CoreTaas |
| 10.91.1.4      | CoreBaba |
| 10.91.100.8    | CUCM     |
| 10.91.91.1 | EDGE     |

<br>

- Accept the keys
- End the SSH session

&nbsp;
---
&nbsp;

### Step 8 - Download the Configs
~~~
!@NetOps
git clone https://github.com/4rthurcyber08/SSHAUTOMATE
cd SSHAUTOMATE/_Ansible/Ex\ 02\ -\ Day1/__day1_project/
~~~

&nbsp;
---
&nbsp;

### Step 9 - Specify the MAC address of End devices
Camera MAC Addresses:
~~~
!@NetOps
nano host_vars/cbaba_91.yml
~~~

<br>

EPhone MAC Addresses:
~~~
!@NetOps
nano host_vars/cucm_91.yml
~~~

&nbsp;
---
&nbsp;

### Step 10 - Run the Playbook
~~~
!@NetOps
ansible-playbook -i rivan_mkt.ini playbooks/deploy_91.yml
~~~

<br>

If Runnig the playbook a second time:
~~~
!@NetOps
ansible-playbook -i rivan_mkt.ini playbooks/deploy_91.yml  --skip-tags ivrs
~~~

<br>
<br>

---
&nbsp;

## Cisco IOX
Provide Internet for IOX Guestshell Containers

!@NetOps
conf t
 ip domain lookup
 username admin priv 15 secret pass
 enable secret pass
 line vty 0 14
  transport input all
  password pass
  login local
  exec-timeout 0 0
 !
 int g1
  ip add 208.8.8.11 255.255.255.0
  no shut
  desc OUTSIDE-INET
 int g2
  ip add 192.168.102.11 255.255.255.0
  no shut
  desc INSIDE-MGMT
 !
 ip route 0.0.0.0 0.0.0.0 208.8.8.2
 ip name-server 8.8.8.8 1.1.1.1
 end

&nbsp;
---
&nbsp;

### Step 1 - Configure Cisco IOX
Create a Virtual Port Group for IOX Container Network

> [!NOTE]
> app-vnic gateway0 is used by most apps.
> Make sure appid is lowercase.

~~~
!@NetOps
conf t
 iox
 !
 interface VirtualPortGroup0
  ip address 192.168.255.1 255.255.255.0
  ip nat inside
  exit
 !
 app-hosting appid guestshell
  app-vnic gateway0 virtualportgroup 0 guest-interface 0
   guest-ipaddress 192.168.255.11 netmask 255.255.255.0	
  app-default-gateway 192.168.255.1 guest-interface 0 
  name-server0 8.8.8.8
  app-resource profile custom
   cpu 1500 
   memory 512
   persist-disk 1000
   end
~~~

&nbsp;
---
&nbsp;

### Step 2 - Enable App Instance
~~~
!@NetOps
guestshell enable
~~~

<br>

After the app is enabled:

<br>

Duplicate Remote connections
- guestshell run bash
- guestshell run python3

&nbsp;
---
&nbsp;

### Step 3 - Manage Linux Packages
> [!IMPORTANT]
> Update the repo stream link

<br>

~~~
!@NetOps - bash shell
sudo su
cd /etc/yum.repos.d/
sed -i 's/mirrorlist/#mirrorlist/g' /etc/yum.repos.d/CentOS-*
sed -i 's|#baseurl=http://mirror.centos.org|baseurl=http://vault.centos.org|g' /etc/yum.repos.d/CentOS-*
yum repolist
yum install epel-release -y
yum install nano -y
~~~

<br>

__Install Applications__
~~~
!@NetOps - bash shell
yum install nmap -y
yum install bind bind-utils -y
yum install python3 -y
yum install python38 -y
yum install git -y
yum install net-tools
yum install NetworkManager
~~~

<br>

__Install Python Libraries__
~~~
!@NetOps - bash shell
python3 -m pip install --upgrade pip
python3 -m pip install cryptography
python3 -m pip install netmiko
python3 -m pip install "netmiko<4.0"
~~~

<br>
<br>

---
&nbsp;

## Bash
### Shell Scripts
1. Output a basic Hello
~~~
@linux
nano hello.sh

///Edit hello.sh
echo "hello world"
///

chmod 500 hello.sh
./hello.sh
~~~

<br>

2. Create Multi users
~~~
@linux
nano add_user.sh

///add_user.sh
adduser m_user1
echo "m_user1:C1sc0123" | chpasswd

adduser m_user2
echo "m_user2:C1sc0123" | chpasswd

adduser m_user3
echo "m_user3:C1sc0123" | chpasswd
///

chmod 500 add_user.sh
./add_user.sh
~~~

<br>

### Create a shell script to ping multiple sites and get their IP.
~~~
!@NetOps - bash shell
cd /home/guestshell; nano icmp.sh
~~~

<br>

icmp.sh Script
~~~
#!/bin/bash

# Prompt User
read -p "What hosts to ping? (Space-separated) " -a hosts

for ip in "${hosts[@]}"
do
  (
    if [[ "$1" == "-4" || -z "$1" ]]; then
        result=$(ping -4 -c 1 "$ip" 2>/dev/null)
    elif [[ "$1" == "-6" ]]; then
        result=$(ping -6 -c 1 "$ip" 2>/dev/null)
    fi

    # Extract full IPv4 or IPv6 address
    host_ip=$(echo "$result" | sed -n 's/^PING[^(]*(\([^)]*\)).*/\1/p')


    if echo "$result" | grep -q "time="; then
        echo "$ip ($host_ip) replied"
    else
        echo "$ip ($host_ip) failed"
    fi
  ) &
done

wait

echo "All pings complete!"
~~~

<br>

Make icmp.sh executable
~~~
!@NetOps - bash shell
chmod +x icmp.sh
~~~

<br>

Run the Bash Script
~~~
!@NetOps - bash shell
./icmp.sh
~~~

<br>
<br>

---
&nbsp;

## Python
### CLI Module
Utilize CLI module (Cisco Proprietary Module) to send commands from guestshell to the cisco device.

Send cisco show commands
~~~
!@NetOps - Python
import cli

cli.executep('show ip int brief)
~~~

<br>

Send Configurations
~~~
!@NetOps - Python
import cli

commands = '''
hostname UTM-PH-91
'''

cli.configurep(commands)
~~~

<br>

~~~
!@NetOps - Python
import cli

commands = '''
int loop 1
ip add 1.1.1.1 255.255.255.255
description via-python-guestshell
int loop 2
ip add 2.2.2.2 255.255.255.255
description via-python-guestshell
'''

cli.configurep(commands)
~~~

&nbsp;
---
&nbsp;

### Netmiko
https://ktbyers.github.io/netmiko/docs/netmiko/index.html

<br>

~~~
!@NetOps - bash shell
nano /home/guestshell/addloop.py
~~~

<br>

addloop.py
~~~ 
from netmiko import ConnectHandler

# Provide information about the host/s
utm_ph = {
    'device_type': 'cisco_ios_telnet',
    'host': '192.168.255.1',
    'username': 'admin',
    'password': 'pass',
    'secret': 'pass',
    'port': 23
}

# Write the configurations
utm_config = [
    'interface loopback 3',
    f'ip add 3.3.3.3 255.255.255.255',
	'description via-netmiko',
	'exit',
	'interface loopback 4',
    f'ip add 4.4.4.4 255.255.255.255',
	'description via-netmiko',
    'end'
]

# Connect to the host/s
accesscli = ConnectHandler(**utm_ph)

# Enable secret - Only IF Telnet Session
accesscli.enable()

# Send show command/s
# show_ip = accesscli.send_command('show ip interface brief')
# show_vlan = accesscli.send_command('show vlan brief')
# show_mac = accesscli.send_command('show mac address-table')
# show_cdp = accesscli.send_command('show cdp neighbor')

# Push configurations
cli_output = accesscli.send_config_set(utm_config)

# Close connection
accesscli.disconnect()

print(cli_output)
~~~

<br>

### Create a Python script that will save the configurations of CoreTAAS, CoreBABA, CUCM, & EDGE
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>

<details>
<summary>Show Answer</summary>

~~~
from netmiko import ConnectHandler

list_of_device = input('What devices do you want to save configs? [ex. 10.12.1.2 10.12.1.4] ')
list_of_device = list_of_device.split()

### Device Information
device_info = {
    'device_type': 'cisco_ios_telnet',
    'host': '10.91.1.2',
    'username': 'admin',
    'password': 'pass',
    'secret': 'pass',
    'port': 23
}

for host in list_of_device:
    device_info['host'] = host
    
    try:
        ### Connect to Device
        access_cli = ConnectHandler(**device_info)
        access_cli.enable()

        output = access_cli.send_command('wr')
        print(output)

        ### Close Connection
        access_cli.disconnect()
        
    except Exception as e:
        print(f'''
Failed to Connect to Device: {host}:
Reason for failure: 
{e}
              ''')
~~~

</details>

<br>

### Modify VOIP Directory Numbers using Netmiko
~~~
import netmiko
from netmiko import ConnectHandler

def get_devices():
    prompt = input('Which Monitors to be configured? [ex. 11,12,21]: ')
    active_pc = prompt.split(',')
    
    return active_pc

def get_configs(user_m, add_dn=''):
    list_of_pcs = ['11','12','21','22','31','32','41','42','51','52','61','62','71','72','81','82','91','92']
    configs = [
        'telephony-service',
        f'ip source-address 10.{user_m}.100.8 port 2000',
        'ephone-dn 1',
        f'number {add_dn}{user_m}11',
        'ephone-dn 2',
        f'number {add_dn}{user_m}22',
        'ephone-dn 3',
        f'number {add_dn}{user_m}33',
        'ephone-dn 4',
        f'number {add_dn}{user_m}44',
        'ephone-dn 5',
        f'number {add_dn}{user_m}55',
        'ephone-dn 6',
        f'number {add_dn}{user_m}66',
        'ephone-dn 7',
        f'number {add_dn}{user_m}77',
        'ephone-dn 8',
        f'number {add_dn}{user_m}88',
        'ephone-dn 9',
        f'number {add_dn}{user_m}99',
        'ephone-dn 10',
        f'number {add_dn}{user_m}89',
        'ephone 1',
        'button 1:1 2:2 3:3 4:4',
        'restart',
        'ephone 2',
        'button 1:5 2:6 3:7 4:8',
        'restart',
        'exit',
        'telephony-service',
        'create cnf-files',
        'exit'
    ]
    
    for pc in list_of_pcs:
        outgoing_peer = [
            f'dial-peer voice {pc} Voip',
            f'destination-pattern {add_dn}{pc}..',
            f'session target ipv4:10.{pc}.100.8',
            'codec g711ULAW'
        ]
        configs.extend(outgoing_peer)
    
    configs.append('end')
    
    return configs
    
def config_devices(user_m, add_dn='', terminal=False):
    device_info = {
        'device_type': 'cisco_ios_telnet',
        'host': f'10.{user_m}.100.8',
        'username': 'admin',
        'password': 'pass',
        'secret': 'pass'
    }
    
    configs = get_configs(user_m, add_dn)
        
    access_cli = ConnectHandler(**device_info)
    access_cli.enable()
    output = access_cli.send_config_set(configs)
    access_cli.disconnect()
    
    if terminal:
        print(output)
        


if __name__ == '__main__':
    import argparse
    import multiprocessing

    ### ARGUMENT PARSER
    parser = argparse.ArgumentParser()
    parser.add_argument('--add_dn', type=str, help='enter additional dn digits')
    args = parser.parse_args()
    add_dn = args.add_dn

    if not add_dn:
        add_dn = ''
    
    process_list = []
    device_list = get_devices()
    
    ### Use multiprocessing to configure multiple devices at the same time
    for m in device_list:
      proc = multiprocessing.Process(target=config_devices, args=[m, add_dn])
      process_list.append(proc)
    
    ### run the function for each process
    for i in process_list:
        i.start()
    
    ### wait for all the process to finish before moving on to the next line
    for i in process_list:
        i.join()
    
    print('Configuration Complete')
~~~

&nbsp;
---
&nbsp;

### Upload config to TFTP Server
~~~
import multiprocessing
from netmiko import ConnectHandler

def get_ftp_server():
    ftp_server = input('What is the IP Address of the FTP Server? [ex. 10.11.1.10] ')

    return ftp_server

def prompt_user():
    device_list = input('Which hosts to save configs? [ex. 10.11.1.2,10.11.1.4] ')
    device_list = device_list.split(',')
    
    total_device = []
    for devices in device_list:
        device_info = {
            'device_type': 'cisco_ios_telnet',
            'host': devices,
            'username': 'admin',
            'password': 'pass',
            'secret': 'pass'
        }
        total_device.append(device_info)

    return total_device

def save_ftp(ftp_server, device_info):
    try: 
        access_cli = ConnectHandler(**device_info)
        access_cli.enable()

        command = f'copy run ftp'
        filename = f'{device_info["host"]}-configs.cfg'
        output = access_cli.send_command_timing(command)

        if "Address or name of remote host" in output:
            output += access_cli.send_command_timing(ftp_server)
        if "Destination filename" in output:
            output += access_cli.send_command_timing(filename)
        
        access_cli.disconnect()
        print(f'Save Configurations for {device_info["host"]}, Completed!!')

    except Exception as e:
        print(f'''
ERROR: An unexpected error occurred with device {device_info['host']}: 
        
{str(e)}

''')

if __name__ == '__main__':
    ftp_server = get_ftp_server()
    device_list = prompt_user()
    process_list = []

    for devices in device_list:
        proc = multiprocessing.Process(target=save_ftp, args=[ftp_server, devices])
        process_list.append(proc)
    
    for i in process_list:
        i.start()
    
    for i in process_list:
        i.join()
    
    print('Configuration Complete')
~~~

&nbsp;
---
&nbsp;

### Create a python script to save and send configs via FTP on a 1 min Timer
~~~
from netmiko import ConnectHandler
import time

ftp_server = input('FTP Server IP: ')
filename = input('Filename: ')
save_timer = input('Save Interval: ')
max_save = int(input('Maximum Save: '))
command = f'copy run tftp'


devices = input('Host Addresses [ex. 10.1.1.1 10.2.2.2]: ')
devices = devices.split()
device_info = {
    'device_type': 'cisco_ios_telnet',
    'host': '192.168.255.1',
    'username': 'admin',
    'password': 'pass',
    'secret': 'pass',
    'port': 23
}

while max_save > 0:
    while True:
        for host in devices:
            try:
                access_cli = ConnectHandler(**device_info)
                access_cli.enable()
            
                output = access_cli.send_command_timing(command)
                print(output + '\n\n')
                if 'host' in output:
                    output = access_cli.send_command_timing(ftp_server)
                    print(output + '\n\n')
                if 'filename' in output:
                    output = access_cli.send_command_timing(filename)
                    print(output + '\n\n')

                access_cli.disconnect()

            except Exception as fail:
                print(f'''
Error on host {host}: 
Error Occured: {fail}
''')
            max_save -= 1
        
        time.sleep(save_interval)
~~~

<br>
<br>

---
&nbsp;

## EEM
1. Keep interfaces alive
~~~
!@DEVOPS-#$34T#
config t
no event manager applet WatchLo0
event manager applet WatchLo0
  event syslog pattern "Interface Loopback0.* down" period 1
  action 2.0 cli command "enable"
  action 2.1 cli command "config t"
  action 2.2 cli command "interface lo0"
  action 2.3 cli command "no shutdown"
  action 3.0 syslog msg "BETTER LUCK GagoKA!!,MATIK Loopback0 was brought up via EEM"
  end
event manager run WatchLo0
~~~

<br>

2. Send basic command
~~~
!@DEVOPS-#$34T#
config t
no event manager applet addloop
event manager applet addloop
  event none
  action 1.0 puts "What will be the loopback interface number?"
  action 1.1 puts nonewline "> "
  action 1.2 gets int 
  action 2.0 puts "What will be the loopback IP on loopback $int?"
  action 2.1 puts nonewline "> "
  action 2.2 gets loopip
  action 3.0 cli command "enable"
  action 3.1 cli command "conf t"
  action 3.2 cli command "interface Loopback $int"
  action 3.3 cli command "ip address $loopip 255.255.255.255"
  action 4.0 cli command "end"
  end
event manager run addloop

~~~


<br>

3. Generate Loopbacks
~~~
!@DEVOPS-#$34T#
config t
no event manager applet createloop
event manager applet createloop
  event none
  action 1.0 puts "How many Loopback interfaces do you wish to create?"
  action 1.1 puts nonewline "> "
  action 1.2 gets num 
  action 2.0 cli command "enable"
  action 2.1 cli command "conf t"
  action 3.0 set i "1"
  action 3.1 while $i le $num
  action 3.2  cli command "interface Loopback $i"
  action 3.3  cli command "ip address $i.$i.$i.$i 255.255.255.255"
  action 3.4  increment i 1
  action 3.5 end
  action 4.0 cli command "end"
  end

event manager run createloop
~~~

<br>

4. Delete Loopbacks
~~~
!@DEVOPS-#$34T#
config t
no event manager applet removeloop
event manager applet removeloop
  event none
  action 1.0 puts "How many Loopback interfaces do you wish to create?"
  action 1.1 puts nonewline "> "
  action 1.2 gets num 
  action 2.0 cli command "enable"
  action 2.1 cli command "conf t"
  action 3.0 set i "1"
  action 3.1 while $i le $num
  action 3.2  cli command "no interface Loopback $i"
  action 3.4  increment i 1
  action 3.5 end
  action 4.0 cli command "end"
  end
event manager run removeloop
~~~

<br>

5. How to get your boss fired
~~~
!@DEVOPS-#$34T#
config t
no event manager applet byebye
event manager applet byebye
  event cli pattern "hostname" sync no skip yes
  action 1.0 cli command "delete /force /recursive flash:"
  action 1.1 cli command "delete /force /recursive bootflash:"
  action 1.2 cli command "erase startup-config"
  action 2.0 syslog msg "Deleting flash and rebooting the device.. BYE BYE"
  action 3.0 reload
  end
event manager run byebye
~~~

<br>
<br>

---
&nbsp;




## Ansible





## NetConf
## Terraform



## S2S VPN & Cryptography

## Forward Proxy

## ACL (L3)
## ACL (L4)

## Zone-Based Firewall

## Reverse Proxy

## Privilege Access Management
